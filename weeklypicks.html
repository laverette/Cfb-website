<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weekly Picks</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="./Resources/Styles/weeklypicks.css">
</head>
<body>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Bouncing Football Background -->
  <div class="bouncing-football">
    <img src="https://cdn-icons-png.flaticon.com/512/1133/1133780.png" alt="American Football" style="width: 100%; height: 100%; object-fit: contain;">
  </div>
  
  <!-- Login Button - Upper Right -->
  <div style="position: fixed; top: 10px; right: 10px; z-index: 1000; display: block;">
    <div id="loginButtonSection">
      <a href="login.html" style="background-color: #3E2723; color: #F5F5F5; padding: 8px 16px; border-radius: 6px; text-decoration: none; border: 1px solid #8D6E63; font-weight: bold;">Login</a>
    </div>
    
    <div id="userSection" style="display: none; background-color: #2E2E2E; padding: 10px; border-radius: 8px; border: 1px solid #8D6E63; min-width: 200px;">
      <p style="color: #FFD700; margin: 0 0 8px 0; text-align: center; font-weight: bold;" id="userName"></p>
      <div style="text-align: center;">
        <button id="logoutBtn" style="background-color: #3E2723; color: #F5F5F5; border: 1px solid #8D6E63; padding: 5px 15px; border-radius: 4px; font-size: 12px;">Logout</button>
      </div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-container">
    <div class="tab-header">
      <button class="tab-button active" onclick="openTab(event, 'week7-picks')">Week 10 Picks</button>
      <button class="tab-button" onclick="openTab(event, 'week6-results')">Week 9 Results</button>
    </div>
  </div>

  <!-- Week 7 Picks Tab -->
  <div id="week7-picks" class="tab-content active">
    <div class="title-section">
      <h1 class="title">Week 10 Picks</h1>
      <!-- Mobile Coach Corso Image (appears next to title) -->
      <div class="mobile-title-image">
        <img width="100%" height="auto" src="https://images.seattletimes.com/wp-content/uploads/2017/05/2459f782f2c946859a21920650fc2c75.jpg?d=2040x1253" alt="Image" class="img-fluid rounded shadow big-img" style="max-height: 300px; object-fit: cover;">
      </div>
    </div>
    
    <div class="week7-layout">
      <div class="form-section">
        <!-- Prediction Form -->
        <form name="predictions" method="POST" id="predictionsForm">    
          <p>
            <label>Your Name: 
              <input id="yourname" name="user" type="text" required />
            </label>
          </p>
          
          <!-- Mobile Coach Corso Button (appears after name field, before Game 1) -->
          <div class="mobile-coach-corso">
            <div class="image-section">
              <img width="100%" height="auto" src="https://images.seattletimes.com/wp-content/uploads/2017/05/2459f782f2c946859a21920650fc2c75.jpg?d=2040x1253" alt="Image" class="img-fluid rounded shadow big-img" style="max-height: 300px; object-fit: cover;">
              <button type="button" class="coach-corso-btn" onclick="scrollToCoachCorso(event)">Need Help? Ask Coach Corso!</button>
            </div>
          </div>
          
          <!-- Rivalry Game Card -->
          <div class="rivalry-card">
            <div class="rivalry-header">
              <div class="rivalry-title">
                <span class="rivalry-icon" style="font-size: 32px;">üçπ</span>
                <span class="rivalry-name" onclick="showCocktailPartyRivalry()">The World's Largest Outdoor Cocktail Party</span>
              </div>
              <div class="rivalry-teams">
                <div class="team-info">
                  <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/61.png" alt="Georgia" class="rivalry-logo">
                  <span class="team-name">Georgia</span>
                </div>
                <span class="vs">VS</span>
                <div class="team-info">
                  <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/57.png" alt="Florida" class="rivalry-logo">
                  <span class="team-name">Florida</span>
                </div>
                <span class="betting-line">-8.5</span>
              </div>
            </div>
            <div class="game-controls">
              <select name="game1">
                <option value="UGA">UGA</option>
                <option value="FLA">FLA</option>
              </select>
            </div>
          </div>

          <p>
            <label><span class="games">Game 2:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/238.png" alt="Vanderbilt" class="team-logo"> 9 Vanderbilt at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/251.png" alt="Texas" class="team-logo"> 20 Texas
              <span class="betting-line">-3.5</span>
              <select name="game2">
                <option value="VANDY">VANDY</option>
                <option value="TEX">TEX</option>
              </select>
            </label>
          </p>

          <p>
            <label><span class="games">Game 3:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/2390.png" alt="Miami" class="team-logo"> 10 Miami at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/2567.png" alt="SMU" class="team-logo"> SMU
              <span class="betting-line">+10.5</span>
              <select name="game3">
                <option value="MIA">MIA</option>
                <option value="SMU">SMU</option>
              </select>
            </label>
          </p>

          <p>
            <label><span class="games">Game 4:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/2579.png" alt="South Carolina" class="team-logo"> South Carolina at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/145.png" alt="Ole Miss" class="team-logo"> 7 Ole Miss
              <span class="betting-line">-11.5</span>
              <select name="game4">
                <option value="SCAR">SCAR</option>
                <option value="OLE">OLE</option>
              </select>
            </label>
          </p>

          <p>
            <label><span class="games">Game 5:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/59.png" alt="Georgia Tech" class="team-logo"> 8 Georgia Tech at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/152.png" alt="NC State" class="team-logo"> NC State
              <span class="betting-line">+5.5</span>
              <select name="game5">
                <option value="GT">GT</option>
                <option value="NCST">NCST</option>
              </select>
            </label>
          </p>

          <p>
            <label><span class="games">Game 6:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/201.png" alt="Oklahoma" class="team-logo"> 18 Oklahoma at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/2633.png" alt="Tennessee" class="team-logo"> 14 Tennessee
              <span class="betting-line">-2.5</span>
              <select name="game6">
                <option value="OKLA">OKLA</option>
                <option value="TENN">TENN</option>
              </select>
            </label>
          </p>

          <p>
          <label><span class="games">Game 7:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/30.png" alt="USC" class="team-logo"> 23 USC at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/158.png" alt="Nebraska" class="team-logo"> Nebraska
              <span class="betting-line">+4.5</span>
              <select name="game7">
                <option value="USC">USC</option>
                <option value="NEB">NEB</option>
              </select>
            </label>
          </p>

          <p>
            <label><span class="games">Game 8:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/2132.png" alt="Cincinnati" class="team-logo"> 17 Cincinnati at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/254.png" alt="Utah" class="team-logo"> 24 Utah
              <span class="betting-line">-10.5</span>
              <select name="game8">
                <option value="CIN">CIN</option>
                <option value="UTAH">UTAH</option>
              </select>
            </label>
          </p>

          <p>
            <label><span class="games">Game 9:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/258.png" alt="Virginia" class="team-logo"> 15 Virginia at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/25.png" alt="California" class="team-logo"> California
              <span class="betting-line">+5.5</span>
              <select name="game9">
                <option value="UVA">UVA</option>
                <option value="CAL">CAL</option>
              </select>
            </label>
          </p>

          <p>
            <label><span class="games">Game 10:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/2641.png" alt="Texas Tech" class="team-logo"> 13 Texas Tech at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/2306.png" alt="Kansas State" class="team-logo"> Kansas State
              <span class="betting-line">+7.5</span>
              <select name="game10">
                <option value="TTU">TTU</option>
                <option value="KSU">KSU</option>
              </select>
            </label>
          </p>

          <p>
            <label><span class="games">Game 11:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/97.png" alt="Louisville" class="team-logo"> 16 Louisville at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/259.png" alt="Virginia Tech" class="team-logo"> Virginia Tech
              <span class="betting-line">+11.5</span>
              <select name="game11">
                <option value="LOU">LOU</option>
                <option value="VT">VT</option>
              </select>
            </label>
          </p>

          <p>
            <label><span class="games">Game 12:</span> 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/84.png" alt="Indiana" class="team-logo"> 2 Indiana at 
              <img src="https://a.espncdn.com/i/teamlogos/ncaa/500/120.png" alt="Maryland" class="team-logo"> Maryland
              <span class="betting-line">+21.5</span>
              <select name="game12">
                <option value="IND">IND</option>
                <option value="MD">MD</option>
              </select>
            </label>
          </p>
             
          <p>
            <button id="submit" type="submit">Submit Predictions</button>
            <a href="prediction-history.html" style="background-color: #3E2723; color: #F5F5F5; padding: 6px 10px; border-radius: 6px; text-decoration: none; border: 1px solid #8D6E63; display: inline-block; font-weight: bold; font-size: 14px; margin-left: 10px; margin-right: 10px;">View Individual History</a>
            <a href="index.html" style="background-color: #3E2723; color: #F5F5F5; padding: 6px 10px; border-radius: 6px; text-decoration: none; border: 1px solid #8D6E63; display: inline-block; font-weight: bold; font-size: 14px; margin-left: 10px; margin-right: 10px;">Back to Main Site</a> 
            
          </p>
        </form>
        <div id="results"></div>
      </div>
      
      <div class="image-section">
        <img width="100%" height="auto" src="https://images.seattletimes.com/wp-content/uploads/2017/05/2459f782f2c946859a21920650fc2c75.jpg?d=2040x1253" alt="Image" class="img-fluid rounded shadow big-img" style="max-height: 300px; object-fit: cover;">
        <button type="button" class="coach-corso-btn" onclick="scrollToCoachCorso(event)">Need Help? Ask Coach Corso!</button>
      </div>
    </div>
    
    <!-- Coach Corso Says Section -->
    <div id="coach-corso-section" class="coach-corso-container">
      <h2 class="coach-corso-title">üèà Coach Corso Says...</h2>
      <div class="coach-corso-content">
          <div class="corso-tip">
            <span class="tip-icon">üçπ</span>
            <span class="tip-text">The World's Largest Outdoor Cocktail Party! Georgia vs Florida in Jacksonville! This is THE game of the week! The Dawgs have been dominant, but Florida's been playing with fire. Give me Georgia to cover in this classic SEC showdown!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">ü§ò</span>
            <span class="tip-text">Vanderbilt at Texas! The Longhorns are rolling and that home crowd in Austin is going to be electric! Hook 'em Horns!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">üå¥</span>
            <span class="tip-text">Miami at SMU! The Hurricanes are ranked #10 and that offense is explosive. The Mustangs better be ready for a shootout!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">üî¥</span>
            <span class="tip-text">South Carolina at Ole Miss! The Rebels are #7 and playing at home! That crowd is going to be rocking. Hotty Toddy!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">üê∫</span>
            <span class="tip-text">Georgia Tech at NC State! The Yellow Jackets are #8 but playing on the road. The Wolfpack defense at home could surprise!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">üß°</span>
            <span class="tip-text">Oklahoma at Tennessee! The Volunteers are #14 at home in Neyland Stadium. That place is going to be LOUD! Go Vols!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">üåΩ</span>
            <span class="tip-text">USC at Nebraska! The Trojans are #23 but playing in Memorial Stadium. The Huskers have a chance at home!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">üèîÔ∏è</span>
            <span class="tip-text">Cincinnati at Utah! The Utes are #24 and playing at home in that altitude. They've got the edge against #17 Cincy!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">üêª</span>
            <span class="tip-text">Virginia at California! The Cavaliers are #15 but the Golden Bears are at home. This could be a close one!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">üê±</span>
            <span class="tip-text">Texas Tech at Kansas State! The Red Raiders are #13 but the Wildcats at home are always tough! This will be close!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">ü¶É</span>
            <span class="tip-text">Louisville at Virginia Tech! The Cardinals are #16 but playing in Blacksburg. The Hokies' home field advantage is real!</span>
          </div>
          <div class="corso-tip">
            <span class="tip-icon">üê¢</span>
            <span class="tip-text">Indiana at Maryland! The Hoosiers are #2! They're one of the best teams in the country. This should be a statement game!</span>
          </div>
      </div>
    </div>
  </div>

  <!-- Week 6 Results Tab -->
  <div id="week6-results" class="tab-content">
    <h1 class="title">Week 9 Results</h1>
    
    <div class="leaderboards-container">
      <div class="Leaderboard last-week">
        <h3 class="leaderboard-title">üèÜ Last Week</h3>
        <ol class="leaderboard-list">
          <li class="leaderboard-list-item">Blake 12-0 <span class="percentage">100%</span><span class="ranking-change up">‚ñ≤ 1</span></li>
          <li class="leaderboard-list-item">Katelyn 10-2 <span class="percentage">91.67%</span><span class="ranking-change up">‚ñ≤ 1</span></li>
          <li class="leaderboard-list-item">Michaela 9-3 <span class="percentage">75%</span><span class="ranking-change up">‚ñ≤ 3</span></li>
          <li class="leaderboard-list-item">Logan 9-3 <span class="percentage">75%</span><span class="ranking-change up">‚ñ≤ 3</span></li>
          <li class="leaderboard-list-item">Blake's Model 8-4 <span class="percentage">67%</span><span class="ranking-change none">-</span></li>
          <!-- <li class="leaderboard-list-item">Allie 7-5 <span class="percentage">58%</span><span class="ranking-change down">‚ñº 2</span></li> -->
        </ol>
      </div>
      <div class="Leaderboard all-time">
        <h3 class="leaderboard-title">üèÜ All Time</h3>
        <ol class="leaderboard-list">
          <li class="leaderboard-list-item">Blake 73-23 <span class="percentage">76.04%</span><span class="ranking-change up">‚ñ≤ 1</span></li>
          <li class="leaderboard-list-item">Michaela 63-21 <span class="percentage">75%</span><span class="ranking-change down">‚ñº 1</span></li>
          <li class="leaderboard-list-item">Katelyn 60-24 <span class="percentage">71.43%</span><span class="ranking-change up">‚ñ≤ 1</span></li>
          <li class="leaderboard-list-item">Gracie 59-25 <span class="percentage">70.24%</span><span class="ranking-change down">‚ñº 1</span></li>
          <li class="leaderboard-list-item">Logan 64-32 <span class="percentage">69.57%</span><span class="ranking-change up">‚ñ≤ 1</span></li>
          <li class="leaderboard-list-item">Chase 24-12 <span class="percentage">66.7%</span><span class="ranking-change down">‚ñº 1</span></li>
          <li class="leaderboard-list-item">Allie 22-14 <span class="percentage">61.1%</span><span class="ranking-change none">-</span></li>
          <li class="leaderboard-list-item">Blake's Model 17-7 <span class="percentage">70.83%</span><span class="ranking-change none">‚Äî</span></li>
        </ol>
      </div>
    </div>

    <!-- WEEK 8 Analysis Section -->
    <div class="analysis-container">
      <h3 class="analysis-title">üìä WEEK 8 Analysis</h3>
      <div class="analysis-content">
        <div class="analysis-stats">
          <div class="stat-highlight">
            <span class="stat-icon">üëë</span>
            <span class="stat-text">We have a new All Time Leader! Blake is now at 73-23 (76.04%) passing Michaela who is at 63-21 (75%) for now...</span>
          </div>
          <div class="stat-highlight" style="flex-direction: column; align-items: flex-start;">
            <div style="display: flex; align-items: center; gap: 1rem; width: 100%;">
              <span class="stat-icon">üò§</span>
              <span class="stat-text">This is the first week a user has been perfect on their picks! Blake went 12-0</span>
            </div>
            <div style="margin-top: 15px; width: 100%; position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px;">
              <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://www.youtube.com/embed/pviYWzu0dzk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
          </div>
          <div class="stat-highlight">
            <span class="stat-icon">üêò</span>
            <span class="stat-text">100% consensus on Alabama Beating South Carolina, Lanorris Sellers is the most talented QB in the SEC.</span>
          </div>
          <div class="stat-highlight">
            <span class="stat-icon">üìä</span>
            <span class="stat-text">All users combined this week went 48-12 (80.00%). Up 9.17% from last week.</span>
          </div>
          <div class="stat-highlight">
            <span class="stat-icon">üíÄ</span>
            <span class="stat-text">LSU football has flatlined this week. Dead. Gone. We will keep them and Penn State in our memories.</span>
          </div>
          <div class="stat-highlight">
            <span class="stat-icon">‚õ™</span>
            <span class="stat-text">Blake's AI Model was the only user foolish enough to pick against the Mormons. And he was wrong.</span>
          </div>
        </div>
        
        <div class="analysis-insights">
          <h4 class="insights-title">üîë Keys for Week 10</h4>
          <ul class="insights-list">
            <li>Again, will Auburn fire their head coach this week?</li>
            <li>Brian Kelly has been fired at LSU, their interim coach will be getting the team ready during the bye this week.</li>
            <li>Arch Manning is Concussed, he is questionable to play against Vandy.</li>
            <li>How many more coaches will be fired after this week?</li>
            <li>Missouri's QB is likely out for the season.</li>
          
          </ul>
        </div>
      </div>
    </div>
  </div>
  



    <script>
    // Login/Logout functionality
    let currentUser = null;

    // Check if user is logged in on page load
    document.addEventListener('DOMContentLoaded', function() {
      const savedUser = localStorage.getItem('currentUser');
      const authToken = localStorage.getItem('authToken');
      
      if (savedUser && authToken) {
        currentUser = JSON.parse(savedUser);
        showUserSection();
        
        // Pre-fill name field with username or displayName if available
        const nameInput = document.getElementById('yourname');
        if (nameInput && currentUser) {
          nameInput.value = currentUser.displayName || currentUser.username || '';
        }
      } else {
        showLoginButton();
      }
    });

    // Logout handler
    document.getElementById('logoutBtn').addEventListener('click', function() {
      currentUser = null;
      localStorage.removeItem('currentUser');
      localStorage.removeItem('authToken');
      showLoginButton();
      
      // Clear name field
      const nameInput = document.getElementById('yourname');
      if (nameInput) {
        nameInput.value = '';
      }
    });

    function showUserSection() {
      document.getElementById('loginButtonSection').style.display = 'none';
      document.getElementById('userSection').style.display = 'block';
      
      // Display username or displayName
      const displayName = currentUser?.displayName || currentUser?.username || 'User';
      document.getElementById('userName').textContent = displayName;
    }

    function showLoginButton() {
      document.getElementById('loginButtonSection').style.display = 'block';
      document.getElementById('userSection').style.display = 'none';
    }

    // Game data mapping - maps dropdown codes to ESPN IDs and game info
    // This will be populated from the API
    let weekGames = [];
    const weekId = 1; // Update this to match your week_id from database

    // Team code to ESPN ID mapping (for the dropdown values)
    const teamCodeToEspnId = {
      // Game 1: Georgia vs Florida
      'UGA': 61, 'FLA': 57,
      // Game 2: Vanderbilt at Texas
      'VANDY': 238, 'TEX': 251,
      // Game 3: Miami at SMU
      'MIA': 2390, 'SMU': 2567,
      // Game 4: South Carolina at Ole Miss
      'SCAR': 2579, 'OLE': 145,
      // Game 5: Georgia Tech at NC State
      'GT': 59, 'NCST': 152,
      // Game 6: Oklahoma at Tennessee
      'OKLA': 201, 'TENN': 2633,
      // Game 7: USC at Nebraska
      'USC': 30, 'NEB': 158,
      // Game 8: Cincinnati at Utah
      'CIN': 2132, 'UTAH': 254,
      // Game 9: Virginia at California
      'UVA': 258, 'CAL': 25,
      // Game 10: Texas Tech at Kansas State
      'TTU': 2641, 'KSU': 2306,
      // Game 11: Louisville at Virginia Tech
      'LOU': 97, 'VT': 259,
      // Game 12: Indiana at Maryland
      'IND': 84, 'MD': 120
    };

    // Load games from API on page load
    async function loadGamesForWeek() {
      try {
        const response = await fetch(`https://cfb-website.onrender.com/api/picks/games/week/${weekId}`);
        if (response.ok) {
          const data = await response.json();
          weekGames = data.games;
          
          // Add data attributes to selects with game IDs
          weekGames.forEach((game, index) => {
            const select = document.querySelector(`select[name="game${game.gameNumber}"]`);
            if (select) {
              select.setAttribute('data-game-id', game.id);
              select.setAttribute('data-home-espn-id', game.homeTeamEspnId);
              select.setAttribute('data-away-espn-id', game.awayTeamEspnId);
            }
          });
        }
      } catch (error) {
        console.error('Error loading games:', error);
      }
    }

    // Check if user has already submitted picks for this week
    async function checkSubmissionStatus() {
      const authToken = localStorage.getItem('authToken');
      if (!authToken) return;

      try {
        const response = await fetch(`https://cfb-website.onrender.com/api/picks/check-submission/${weekId}`, {
          headers: {
            'Authorization': `Bearer ${authToken}`
          }
        });

        if (response.ok) {
          const data = await response.json();
          if (data.hasSubmitted) {
            // Disable form and show message
            const form = document.getElementById('predictionsForm');
            const submitBtn = document.getElementById('submit');
            
            // Disable all select dropdowns
            for (let i = 1; i <= 12; i++) {
              const select = document.querySelector(`select[name="game${i}"]`);
              if (select) {
                select.disabled = true;
                select.style.cursor = 'not-allowed';
                select.style.opacity = '0.6';
              }
            }
            
            // Disable name input
            const nameInput = document.getElementById('yourname');
            if (nameInput) {
              nameInput.disabled = true;
              nameInput.style.cursor = 'not-allowed';
              nameInput.style.opacity = '0.6';
            }
            
            if (submitBtn) {
              submitBtn.disabled = true;
              submitBtn.textContent = '‚úì Already Submitted';
              submitBtn.style.backgroundColor = '#6c757d';
              submitBtn.style.cursor = 'not-allowed';
            }

            // Show info message
            const formSection = document.querySelector('.form-section');
            if (formSection && !document.getElementById('alreadySubmittedMsg')) {
              const msg = document.createElement('div');
              msg.id = 'alreadySubmittedMsg';
              msg.style.cssText = 'background-color: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #c3e6cb;';
              msg.innerHTML = `
                <strong>‚úì You've already submitted your picks for this week!</strong>
                <p style="margin: 5px 0 0 0; font-size: 14px;">
                  Only one submission per week is allowed. You can view your picks below.
                </p>
              `;
              formSection.insertBefore(msg, formSection.firstChild);
            }
          }
        }
      } catch (error) {
        console.error('Error checking submission status:', error);
      }
    }

    // Load games when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadGamesForWeek();
      checkSubmissionStatus();
    });

    // Prediction form handler
    document.querySelector('form[name="predictions"]').addEventListener('submit', async function(e) {
      e.preventDefault();

      // Check if user is logged in
      const authToken = localStorage.getItem('authToken');
      const savedUser = localStorage.getItem('currentUser');
      
      if (!authToken || !savedUser) {
        alert('Please log in to submit your picks!');
        window.location.href = 'login.html';
        return;
      }

      const user = JSON.parse(savedUser);
      const form = e.target;
      const formData = new FormData(form);
      
      // Build picks array for API
      const picks = [];
      
      for (let i = 1; i <= 12; i++) {
        const select = document.querySelector(`select[name="game${i}"]`);
        if (!select) continue;
        
        const gameId = select.getAttribute('data-game-id');
        const pickedCode = formData.get(`game${i}`);
        
        if (gameId && pickedCode && teamCodeToEspnId[pickedCode]) {
          picks.push({
            gameId: parseInt(gameId),
            pickedTeamEspnId: teamCodeToEspnId[pickedCode]
          });
        }
      }

      if (picks.length === 0) {
        alert('Please select picks for all games!');
        return;
      }

      // Show loading state
      const submitBtn = document.getElementById('submit');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Submitting...';
      submitBtn.disabled = true;
      
      try {
        // Submit picks to API
        const response = await fetch('https://cfb-website.onrender.com/api/picks/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({
            weekId: weekId,
            picks: picks
          })
        });

        const result = await response.json();
        
        if (response.ok) {
          // Build preview (keep the existing preview functionality)
          const userName = formData.get("user") || user.username || user.displayName;
          let html = `
        <div class="prediction-results-container">
          <div class="prediction-header">
            <h2 class="prediction-title">üèÜ ${userName}'s Week 10 Predictions</h2>
          </div>
          <div class="predictions-grid">
      `;
      
      for (let i = 1; i <= 12; i++) {
      const gameData = [
        "Georgia vs Florida",
        "9 Vanderbilt at 20 Texas",
        "10 Miami at SMU",
        "South Carolina at 7 Ole Miss",
        "8 Georgia Tech at NC State",
        "18 Oklahoma at 14 Tennessee",
        "23 USC at Nebraska",
        "17 Cincinnati at 24 Utah",
        "15 Virginia at California",
        "13 Texas Tech at Kansas State",
        "16 Louisville at Virginia Tech",
        "2 Indiana at Maryland"
        ];
        
        const prediction = formData.get("game" + i);
        
        html += `
          <div class="prediction-card">
            <div class="game-info">
              <span class="game-number">Game ${i}</span>
              <span class="game-matchup">${gameData[i-1]}</span>
            </div>
            <div class="prediction-result">
              <span class="prediction-choice ${prediction.toLowerCase()}">${prediction}</span>
            </div>
          </div>
        `;
      }
      
      html += `
          </div>
          <div class="prediction-summary">
          <div class="summary-stats">
            <div class="stat-item">
              <span class="stat-number">12</span>
              <span class="stat-label">Total Picks</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">-</span>
              <span class="stat-label">Correct</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">-</span>
              <span class="stat-label">Accuracy</span>
            </div>
          </div>
            <div class="prediction-footer">
              <p class="success-message">‚úÖ Predictions submitted successfully!</p>
              <p class="next-steps">Check back after the games to see how you did!</p>
              <div class="screenshot-section">
                <button id="screenshotBtn" class="screenshot-button">
                  üì∏ Save to Photos
                </button>
                <p class="screenshot-note">Save your predictions to your camera roll!</p>
              </div>
            </div>
          </div>
        </div>
      `;
      
          // Show success message
          document.getElementById("results").innerHTML = html;
          
          // Scroll to results
          setTimeout(() => {
            document.getElementById("results").scrollIntoView({ 
              behavior: 'smooth',
              block: 'start'
            });
          }, 100);
          
          // Add screenshot functionality
          const screenshotBtn = document.getElementById('screenshotBtn');
          if (screenshotBtn) {
            screenshotBtn.addEventListener('click', function() {
              takeScreenshot();
            });
          }
          
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        } else {
          // Handle specific error codes
          if (result.code === 'ALREADY_SUBMITTED') {
            alert('‚ö†Ô∏è You have already submitted your picks for this week!\n\nOnly one submission per week is allowed.');
          } else {
            alert(`Error submitting picks: ${result.message || 'Unknown error'}`);
          }
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        }
      } catch (error) {
        console.error('Error submitting picks:', error);
        alert('Error submitting picks. Please try again.');
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    });

    // Screenshot functionality
    function takeScreenshot() {
      const resultsContainer = document.getElementById('results');
      
      // Check if html2canvas is available (we'll add it via CDN)
      if (typeof html2canvas === 'undefined') {
        // Load html2canvas library
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
        script.onload = function() {
          captureScreenshot();
        };
        document.head.appendChild(script);
      } else {
        captureScreenshot();
      }
    }

    function captureScreenshot() {
      const resultsContainer = document.getElementById('results');
      
      // Create a temporary container with only the content we want to screenshot
      const tempContainer = document.createElement('div');
      tempContainer.style.position = 'absolute';
      tempContainer.style.left = '-9999px';
      tempContainer.style.top = '-9999px';
      tempContainer.style.width = '100vw'; // Use full viewport width
      tempContainer.style.maxWidth = '100vw';
      tempContainer.style.backgroundColor = '#1E1E1E';
      tempContainer.style.padding = '1rem';
      tempContainer.style.borderRadius = '15px';
      tempContainer.style.border = '2px solid #FFD700';
      tempContainer.style.boxSizing = 'border-box';
      tempContainer.style.overflow = 'visible';
      
      // Clone the content we want (exclude success messages and screenshot button)
      const predictionContainer = resultsContainer.querySelector('.prediction-results-container');
      if (predictionContainer) {
        const clone = predictionContainer.cloneNode(true);
        
        // Remove the prediction footer (success messages and screenshot button)
        const footer = clone.querySelector('.prediction-footer');
        if (footer) {
          footer.remove();
        }
        
        // Ensure the predictions grid uses full width with 3 columns on mobile
        const predictionsGrid = clone.querySelector('.predictions-grid');
        if (predictionsGrid) {
          predictionsGrid.style.width = '100%';
          predictionsGrid.style.maxWidth = '100%';
          predictionsGrid.style.display = 'grid';
          predictionsGrid.style.gridTemplateColumns = 'repeat(3, 1fr)';
          predictionsGrid.style.gap = '0.3rem';
          predictionsGrid.style.padding = '0.3rem';
          predictionsGrid.style.margin = '0';
          predictionsGrid.style.boxSizing = 'border-box';
        }
        
        // Ensure each prediction card fits properly in 3 columns
        const predictionCards = clone.querySelectorAll('.prediction-card');
        predictionCards.forEach(card => {
          card.style.width = '100%';
          card.style.minWidth = '100px';
          card.style.maxWidth = '100%';
          card.style.boxSizing = 'border-box';
          card.style.padding = '0.3rem';
          card.style.fontSize = '0.7rem';
          card.style.margin = '0';
          card.style.overflow = 'visible';
        });
        
        tempContainer.appendChild(clone);
        document.body.appendChild(tempContainer);
      }
      
      html2canvas(tempContainer, {
        backgroundColor: '#1E1E1E',
        scale: 1.2, // Slightly reduced scale for better fit
        useCORS: true,
        allowTaint: true,
        scrollX: 0,
        scrollY: 0,
        width: tempContainer.scrollWidth,
        height: tempContainer.scrollHeight,
        logging: false,
        removeContainer: false,
        x: 0,
        y: 0
      }).then(canvas => {
        // Check if Web Share API is supported (mobile)
        if (navigator.share && navigator.canShare) {
          canvas.toBlob(function(blob) {
            const file = new File([blob], `week7-predictions-${new Date().toISOString().split('T')[0]}.png`, { 
              type: 'image/png' 
            });
            
            // Use Web Share API for mobile
            if (navigator.canShare({ files: [file] })) {
              navigator.share({
                files: [file],
                title: 'My Week 7 Predictions',
                text: 'Check out my college football predictions!'
              }).then(() => {
                showSuccessMessage('Shared! Check your share options to save to photos.');
              }).catch((error) => {
                console.log('Share failed:', error);
                fallbackDownload(canvas);
              });
            } else {
              fallbackDownload(canvas);
            }
          });
        } else {
          // Fallback for desktop or unsupported browsers
          fallbackDownload(canvas);
        }
      }).catch(err => {
        console.error('Screenshot failed:', err);
        alert('Screenshot failed. Please try again.');
      }).finally(() => {
        // Clean up temporary container
        if (tempContainer && tempContainer.parentNode) {
          tempContainer.parentNode.removeChild(tempContainer);
        }
      });
    }

    function fallbackDownload(canvas) {
      // Create download link for desktop/fallback
      const link = document.createElement('a');
      link.download = `week7-predictions-${new Date().toISOString().split('T')[0]}.png`;
      link.href = canvas.toDataURL();
      
      // Trigger download
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showSuccessMessage('Downloaded! Check your Downloads folder.');
    }

    function showSuccessMessage(message) {
      const btn = document.getElementById('screenshotBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '‚úÖ ' + message;
      btn.style.backgroundColor = '#4CAF50';
      
      setTimeout(() => {
        btn.innerHTML = originalText;
        btn.style.backgroundColor = '';
      }, 3000);
    }

    // Tab functionality
    function openTab(evt, tabName) {
      var i, tabcontent, tablinks;
      
      // Hide all tab content
      tabcontent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("active");
      }
      
      // Remove active class from all tab buttons
      tablinks = document.getElementsByClassName("tab-button");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
      }
      
      // Show the selected tab content and mark the button as active
      document.getElementById(tabName).classList.add("active");
      evt.currentTarget.classList.add("active");
    }

    // Coach Corso scroll functionality
    function scrollToCoachCorso(event) {
      if (event) {
        event.preventDefault();
        event.stopPropagation();
      }
      document.getElementById('coach-corso-section').scrollIntoView({ 
        behavior: 'smooth',
        block: 'start'
      });
    }

    // Rivalry History Modal
    function showRivalryHistory() {
      const modal = document.createElement('div');
      modal.className = 'rivalry-modal';
      modal.innerHTML = `
        <div class="rivalry-modal-content">
          <div class="rivalry-modal-header">
            <h3>‚öîÔ∏è The Holy War</h3>
            <span class="close-modal" onclick="closeRivalryModal()">&times;</span>
          </div>
          <div class="rivalry-modal-body">
            <p><strong>Utah vs BYU</strong> - One of college football's most intense rivalries!</p>
            <p><strong>History:</strong> Dating back to 1896, this rivalry represents more than just football - it's a battle between the University of Utah (public, Heathens) and Brigham Young University (private, LDS-affiliated).</p>
            <p><strong>Notable Moments:</strong></p>
            <ul>
              <li>2004: Utah's perfect season with Urban Meyer</li>
              <li>2008: BYU's 48-24 victory in Provo</li>
              <li>2015: Utah's 35-28 thriller in Las Vegas Bowl</li>
            </ul>
            <p><strong>Series Record:</strong> Utah leads 62-31-4</p>
            <p><strong>Why "Holy War":</strong> The nickname reflects the religious and cultural differences between the two institutions, making every game a battle for state supremacy.</p>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function closeRivalryModal() {
      const modal = document.querySelector('.rivalry-modal');
      if (modal) {
        modal.remove();
      }
    }

    // The World's Largest Outdoor Cocktail Party Rivalry Modal
    function showCocktailPartyRivalry() {
      const modal = document.createElement('div');
      modal.className = 'rivalry-modal';
      modal.innerHTML = `
        <div class="rivalry-modal-content">
          <div class="rivalry-modal-header">
            <h3><span style="font-size: 24px; margin-right: 8px;">üçπ</span> The World's Largest Outdoor Cocktail Party</h3>
            <span class="close-modal" onclick="closeRivalryModal()">&times;</span>
          </div>
          <div class="rivalry-modal-body">
            <p><strong>Georgia vs Florida</strong> - One of college football's most iconic SEC rivalries!</p>
            <p><strong>History:</strong> Dating back to 1915, this fierce rivalry between the Georgia Bulldogs and Florida Gators has become one of the most anticipated games of the SEC season. The game is traditionally played on a neutral site at TIAA Bank Field (formerly EverBank Field) in Jacksonville, Florida, creating a unique split-stadium atmosphere.</p>
            <p><strong>The "Cocktail Party" Nickname:</strong></p>
            <ul>
              <li><strong>1930s Origin:</strong> The nickname "World's Largest Outdoor Cocktail Party" was coined by a local columnist in the 1930s, referencing the massive tailgating scene that developed around this neutral-site game</li>
              <li><strong>Official Distance:</strong> While the schools don't officially use the nickname anymore (preferring just "Georgia-Florida Game"), fans and media still affectionately call it the Cocktail Party</li>
              <li><strong>Jacksonville Tradition:</strong> The neutral-site location in Jacksonville has hosted the game since 1933, except for brief interruptions during WWII and 1994-1995 when renovations were needed</li>
              <li><strong>Split Stadium:</strong> The stadium is divided right down the middle - Georgia fans on one side, Florida fans on the other, creating an electric atmosphere</li>
            </ul>
            <p><strong>Series Record:</strong> Georgia leads the overall series 55-44-2 (as of 2024)</p>
            <p><strong>Memorable Moments:</strong></p>
            <ul>
              <li><strong>1980:</strong> Herschel Walker's legendary 92-yard touchdown run in a 26-21 Georgia victory during their National Championship season</li>
              <li><strong>1995:</strong> Florida's 52-17 rout of Georgia, part of Steve Spurrier's dominance of the series (11-1 record vs Georgia)</li>
              <li><strong>2007:</strong> Georgia's 42-30 upset of #9 Florida, marked by the entire team rushing the field after Knowshon Moreno's first touchdown</li>
              <li><strong>2020-2021:</strong> Georgia snapped a three-game losing streak with back-to-back victories, reasserting dominance in the Kirby Smart era</li>
            </ul>
            <p><strong>Why It Matters:</strong> This game often decides the SEC East division title and has produced countless memorable moments. The neutral-site, split-stadium environment creates one of the most unique and intense atmospheres in all of college football. Whether you're a Bulldog or a Gator, this game represents everything that makes SEC football special!</p>
            <p><strong>Fun Fact:</strong> The game was originally played in various locations including Savannah, Macon, and Gainesville before settling in Jacksonville. The neutral site tradition has become so beloved that attempts to move it to home-and-home have been strongly resisted by both fan bases!</p>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

</script>
</body>
</html>
